import java.util.*; 

// Class implementing Least Recently Used (LRU) page replacement algorithm
class Lru 
{
    // Declaration of variables
    int p[], n, fr[], m, fs[], index, k, l, flag1 = 0, flag2 = 0, pf = 0, framesize = 3, i, j; 
    Scanner src = new Scanner(System.in); 

    // Function to read input from user
    void read() 
    { 
        System.out.println("Enter page table size"); 
        n = src.nextInt();                      // number of pages in reference string
        p = new int[n];                         // array to hold page reference string

        System.out.println("Enter the Reference String "); 
        for (int i = 0; i < n; i++) 
            p[i] = src.nextInt();               // read reference string

        System.out.println("Enter the Number of frames "); 
        m = src.nextInt();                      // number of frames in memory
        fr = new int[m];                        // frame array to store pages currently in memory
        fs = new int[m];                        // array used to mark if a frame has been recently used
    } 

    // Function to display the contents of frames
    void display() 
    { 
        System.out.println("\n"); 
        for (i = 0; i < m; i++) 
        { 
            if (fr[i] == -1)                    // empty frame
                System.out.println("[ ]"); 
            else                                // display the page number in frame
                System.out.println("[" + fr[i] + "]"); 
        } 
    } 

    // Function to implement LRU page replacement
    void lru() 
    { 
        // Initialize all frames to -1 (empty)
        for (i = 0; i < m; i++) 
        { 
            fr[i] = -1; 
        } 

        // Traverse each page in reference string
        for (j = 0; j < n; j++) 
        { 
            flag1 = 0; 
            flag2 = 0; 

            // Check if current page is already in frame (page hit)
            for (i = 0; i < m; i++) 
            { 
                if (fr[i] == p[j]) 
                { 
                    flag1 = 1; 
                    flag2 = 1; 
                    break; 
                } 
            } 

            // If page is not in frame but an empty frame is available
            if (flag1 == 0) 
            { 
                for (i = 0; i < m; i++) 
                { 
                    if (fr[i] == -1) 
                    { 
                        fr[i] = p[j];          // place page in empty frame
                        flag2 = 1; 
                        break; 
                    } 
                } 
            } 

            // If page is not found and no empty frame is available (page fault occurs)
            if (flag2 == 0) 
            { 
                // Initialize all usage markers to 0
                for (i = 0; i < 3; i++) 
                    fs[i] = 0; 

                // Check last 'framesize-1' pages to find which frame was least recently used
                for (k = j - 1, l = 1; l <= framesize - 1; l++, k--) 
                { 
                    for (i = 0; i < 3; i++) 
                    { 
                        if (fr[i] == p[k]) 
                            fs[i] = 1;         // mark recently used pages
                    } 
                } 

                // Find the frame that was least recently used (fs[i] == 0)
                for (i = 0; i < 3; i++) 
                { 
                    if (fs[i] == 0) 
                        index = i; 
                } 

                // Replace least recently used page with the new one
                fr[index] = p[j]; 
                pf++;                           // increment page fault counter
            } 

            // Display current page reference and frames after this operation
            System.out.print("Page : " + p[j]); 
            display(); 
        } 

        // Print total page faults at the end
        System.out.println("\n Number of page fault:" + pf); 
    } 

    // Main function to execute the program
    public static void main(String args[]) 
    { 
        Lru a = new Lru(); 
        a.read();        // read input from user
        a.lru();         // execute LRU page replacement
        a.display();     // display final frame content
    } 
} 
